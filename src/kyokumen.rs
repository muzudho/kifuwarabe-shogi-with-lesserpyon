//! 局面の実装。

use crate::Kiki;
use crate::Te;
use crate::DIRECT;
use crate::{KomaInf, KomaInfo, Kyokumen};

use std::ops::BitAnd;

impl Default for Kyokumen {
    fn default() -> Self {
        Kyokumen {
            banpadding: [KomaInf::Wall; 16],
            ban: [KomaInf::EMP; 16 * (9 + 2)],
            control_s: [0; 16 * 11],
            control_e: [0; 16 * 11],
            hand: [0; KomaInf::EHI as usize + 1 as usize],
            tesu: 0,
            king_s: 0,
            king_e: 0,
            can_move: [
                // Direct[0]=17,
                // |／
                //  ￣
                [
                    // 'Cascadia Code' のような 等幅フォント にしても桁揃えがずれるぜ☆（＾～＾）
                    // プロポーショナル・フォントなアルファベットを使う海外に 方眼紙 の文化は無いのだろう☆（＾～＾）
                    // ちょっとずつ だんだんずれてくる……、仕方ない 横幅を長く取って ずれ を目立たなくさせるか……☆（＾～＾）
                    //
                    // 桁揃えって何？　だって☆（＾～＾）！？
                    // おいお前、PC9801 の画面の　漢字とアルファベットが混合しても等幅なのを見てこいだぜ☆ｍ９（＾～＾）！
                    // 暴れたろ☆（＾～＾）！
                    //
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , △歩   , △香   , △桂    , △銀   , △金   , △角   , △飛   ,
                    0_____, 0_____, 0_____, 0_____, 1_____, 0_____, 0_____, 0_____, //
                    // △王, △と   , △杏   , △圭    , △全   , △金   , △馬   , △龍   ,
                    1_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, //
                    // 空 , ▼歩   , ▼香   , ▼桂    , ▼銀   , ▼金   , ▼角   , ▼飛   ,
                    0_____, 0_____, 0_____, 0_____, 1_____, 1_____, 0_____, 0_____, //
                    // ▼王, ▼と   , ▼杏   , ▼圭    , ▼全   , ▼金   , ▼馬   , ▼龍   ,
                    1_____, 1_____, 1_____, 1_____, 1_____, 1_____, 0_____, 1_____, //
                    // ▼壁, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼空, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                ],
                // Direct[0]=1,
                // ↓
                [
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , △歩   , △香   , △桂    , △銀   , △金   , △角   , △飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 1_____, 0_____, 0_____, //
                    // △王, △と   , △杏   , △圭    , △全   , △金   , △馬   , △龍   ,
                    1_____, 1_____, 1_____, 1_____, 1_____, 1_____, 1_____, 0_____, //
                    // 空 , ▼歩   , ▼香   , ▼桂    , ▼銀   , ▼金   , ▼角   , ▼飛   ,
                    0_____, 1_____, 0_____, 0_____, 1_____, 1_____, 0_____, 0_____, //
                    // ▼王, ▼と   , ▼杏   , ▼圭    , ▼全   , ▼金   , ▼馬   , ▼龍   ,
                    1_____, 1_____, 1_____, 1_____, 1_____, 1_____, 1_____, 0_____, //
                    // ▼壁, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼空, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                ],
                // Direct[0]=-15,
                // ＼|
                // ￣
                [
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , △歩   , △香   , △桂    , △銀   , △金   , △角   , △飛   ,
                    0_____, 0_____, 0_____, 0_____, 1_____, 0_____, 0_____, 0_____, //
                    // △王, △と   , △杏   , △圭    , △全   , △金   , △馬   , △龍   ,
                    1_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, //
                    // 空 , ▼歩   , ▼香   , ▼桂    , ▼銀   , ▼金   , ▼角   , ▼飛   ,
                    0_____, 0_____, 0_____, 0_____, 1_____, 1_____, 0_____, 0_____, //
                    // ▼王, ▼と   , ▼杏   , ▼圭    , ▼全   , ▼金   , ▼馬   , ▼龍   ,
                    1_____, 1_____, 1_____, 1_____, 1_____, 1_____, 0_____, 1_____, //
                    // ▼壁, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼空, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                ],
                // Direct[0]=16,
                // ←
                [
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , △歩   , △香   , △桂    , △銀   , △金   , △角   , △飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 1_____, 0_____, 0_____, //
                    // △王, △と   , △杏   , △圭    , △全   , △金   , △馬   , △龍   ,
                    1_____, 1_____, 1_____, 1_____, 1_____, 1_____, 1_____, 0_____, //
                    // 空 , ▼歩   , ▼香   , ▼桂    , ▼銀   , ▼金   , ▼角   , ▼飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 1_____, 0_____, 0_____, //
                    // ▼王, ▼と   , ▼杏   , ▼圭    , ▼全   , ▼金   , ▼馬   , ▼龍   ,
                    1_____, 1_____, 1_____, 1_____, 1_____, 1_____, 1_____, 0_____, //
                    // ▼壁, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼空, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                ],
                // Direct[0]=-16,
                // →
                [
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , △歩   , △香   , △桂    , △銀   , △金   , △角   , △飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 1_____, 0_____, 0_____, //
                    // △王, △と   , △杏   , △圭    , △全   , △金   , △馬   , △龍   ,
                    1_____, 1_____, 1_____, 1_____, 1_____, 1_____, 1_____, 0_____, //
                    // 空 , ▼歩   , ▼香   , ▼桂    , ▼銀   , ▼金   , ▼角   , ▼飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 1_____, 0_____, 0_____, //
                    // ▼王, ▼と   , ▼杏   , ▼圭    , ▼全   , ▼金   , ▼馬   , ▼龍   ,
                    1_____, 1_____, 1_____, 1_____, 1_____, 1_____, 1_____, 0_____, //
                    // ▼壁, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼空, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                ],
                // Direct[0]=15,
                //  __
                // |＼
                [
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , △歩   , △香   , △桂    , △銀   , △金   , △角   , △飛   ,
                    0_____, 0_____, 0_____, 0_____, 1_____, 1_____, 0_____, 0_____, //
                    // △王, △と   , △杏   , △圭    , △全   , △金   , △馬   , △龍   ,
                    1_____, 1_____, 1_____, 1_____, 1_____, 1_____, 0_____, 1_____, //
                    // 空 , ▼歩   , ▼香   , ▼桂    , ▼銀   , ▼金   , ▼角   , ▼飛   ,
                    0_____, 0_____, 0_____, 0_____, 1_____, 0_____, 0_____, 0_____, //
                    // ▼王, ▼と   , ▼杏   , ▼圭    , ▼全   , ▼金   , ▼馬   , ▼龍   ,
                    1_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, //
                    // ▼壁, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼空, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                ],
                // Direct[0]=-1,
                // ↑
                [
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , △歩   , △香   , △桂    , △銀   , △金   , △角   , △飛   ,
                    0_____, 1_____, 0_____, 0_____, 1_____, 1_____, 0_____, 0_____, //
                    // △王, △と   , △杏   , △圭    , △全   , △金   , △馬   , △龍   ,
                    1_____, 1_____, 1_____, 1_____, 1_____, 1_____, 1_____, 0_____, //
                    // 空 , ▼歩   , ▼香   , ▼桂    , ▼銀   , ▼金   , ▼角   , ▼飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 1_____, 0_____, 0_____, //
                    // ▼王, ▼と   , ▼杏   , ▼圭    , ▼全   , ▼金   , ▼馬   , ▼龍   ,
                    1_____, 1_____, 1_____, 1_____, 1_____, 1_____, 1_____, 0_____, //
                    // ▼壁, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼空, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                ],
                // Direct[0]=-17
                // __
                // ／|
                [
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , △歩   , △香   , △桂    , △銀   , △金   , △角   , △飛   ,
                    0_____, 0_____, 0_____, 0_____, 1_____, 1_____, 0_____, 0_____, //
                    // △王, △と   , △杏   , △圭    , △全   , △金   , △馬   , △龍   ,
                    1_____, 1_____, 1_____, 1_____, 1_____, 1_____, 0_____, 1_____, //
                    // 空 , ▼歩   , ▼香   , ▼桂    , ▼銀   , ▼金   , ▼角   , ▼飛   ,
                    0_____, 0_____, 0_____, 0_____, 1_____, 0_____, 0_____, 0_____, //
                    // ▼王, ▼と   , ▼杏   , ▼圭    , ▼全   , ▼金   , ▼馬   , ▼龍   ,
                    1_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, //
                    // ▼壁, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼空, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                ],
                // Direct[0]=14,先手の桂馬
                [
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , △歩   , △香   , △桂    , △銀   , △金   , △角   , △飛   ,
                    0_____, 0_____, 0_____, 1_____, 0_____, 0_____, 0_____, 0_____, //
                    // △王, △と   , △杏   , △圭    , △全   , △金   , △馬   , △龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , ▼歩   , ▼香   , ▼桂    , ▼銀   , ▼金   , ▼角   , ▼飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼王, ▼と   , ▼杏   , ▼圭    , ▼全   , ▼金   , ▼馬   , ▼龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼壁, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼空, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                ],
                // Direct[0]=-18,先手の桂馬
                [
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , △歩   , △香   , △桂    , △銀   , △金   , △角   , △飛   ,
                    0_____, 0_____, 0_____, 1_____, 0_____, 0_____, 0_____, 0_____, //
                    // △王, △と   , △杏   , △圭    , △全   , △金   , △馬   , △龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , ▼歩   , ▼香   , ▼桂    , ▼銀   , ▼金   , ▼角   , ▼飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼王, ▼と   , ▼杏   , ▼圭    , ▼全   , ▼金   , ▼馬   , ▼龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼壁, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼空, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                ],
                // Direct[0]=-14,後手の桂馬
                [
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , △歩   , △香   , △桂    , △銀   , △金   , △角   , △飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // △王, △と   , △杏   , △圭    , △全   , △金   , △馬   , △龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , ▼歩   , ▼香   , ▼桂    , ▼銀   , ▼金   , ▼角   , ▼飛   ,
                    0_____, 0_____, 0_____, 1_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼王, ▼と   , ▼杏   , ▼圭    , ▼全   , ▼金   , ▼馬   , ▼龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼壁, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼空, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                ],
                // Direct[0]=18,後手の桂馬
                [
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , △歩   , △香   , △桂    , △銀   , △金   , △角   , △飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // △王, △と   , △杏   , △圭    , △全   , △金   , △馬   , △龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , ▼歩   , ▼香   , ▼桂    , ▼銀   , ▼金   , ▼角   , ▼飛   ,
                    0_____, 0_____, 0_____, 1_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼王, ▼と   , ▼杏   , ▼圭    , ▼全   , ▼金   , ▼馬   , ▼龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼壁, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼空, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                ],
            ],
            // その方向に飛んで動くことが出来るか？
            // 飛車角香車と龍と馬しかそういう駒はない
            can_jump: [
                // Direct[0]=17,
                // ＼|
                // ￣
                [
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , △歩   , △香   , △桂    , △銀   , △金   , △角   , △飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, 0_____, //
                    // △王, △と   , △杏   , △圭    , △全   , △金   , △馬   , △龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, 0_____, //
                    // 空 , ▼歩   , ▼香   , ▼桂    , ▼銀   , ▼金   , ▼角   , ▼飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, 0_____, //
                    // ▼王, ▼と   , ▼杏   , ▼圭    , ▼全   , ▼金   , ▼馬   , ▼龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, 0_____, //
                    // ▼壁, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼空, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                ],
                // Direct[0]=1,
                // ↓
                [
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , △歩   , △香   , △桂    , △銀   , △金   , △角   , △飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, //
                    // △王, △と   , △杏   , △圭    , △全   , △金   , △馬   , △龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, //
                    // 空 , ▼歩   , ▼香   , ▼桂    , ▼銀   , ▼金   , ▼角   , ▼飛   ,
                    0_____, 0_____, 1_____, 0_____, 0_____, 0_____, 0_____, 1_____, //
                    // ▼王, ▼と   , ▼杏   , ▼圭    , ▼全   , ▼金   , ▼馬   , ▼龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, //
                    // ▼壁, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼空, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                ],
                // Direct[0]=-15,
                // ＼|
                // ￣
                [
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , △歩   , △香   , △桂    , △銀   , △金   , △角   , △飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, 0_____, //
                    // △王, △と   , △杏   , △圭    , △全   , △金   , △馬   , △龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, 0_____, //
                    // 空 , ▼歩   , ▼香   , ▼桂    , ▼銀   , ▼金   , ▼角   , ▼飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, 0_____, //
                    // ▼王, ▼と   , ▼杏   , ▼圭    , ▼全   , ▼金   , ▼馬   , ▼龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, 0_____, //
                    // ▼壁, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼空, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                ],
                // Direct[0]=16,
                // ←
                [
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , △歩   , △香   , △桂    , △銀   , △金   , △角   , △飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, //
                    // △王, △と   , △杏   , △圭    , △全   , △金   , △馬   , △龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, //
                    // 空 , ▼歩   , ▼香   , ▼桂    , ▼銀   , ▼金   , ▼角   , ▼飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, //
                    // ▼王, ▼と   , ▼杏   , ▼圭    , ▼全   , ▼金   , ▼馬   , ▼龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, //
                    // ▼壁, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼空, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                ],
                // Direct[0]=-16,
                // →
                [
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , △歩   , △香   , △桂    , △銀   , △金   , △角   , △飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, //
                    // △王, △と   , △杏   , △圭    , △全   , △金   , △馬   , △龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, //
                    // 空 , ▼歩   , ▼香   , ▼桂    , ▼銀   , ▼金   , ▼角   , ▼飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, //
                    // ▼王, ▼と   , ▼杏   , ▼圭    , ▼全   , ▼金   , ▼馬   , ▼龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, //
                    // ▼壁, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼空, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                ],
                // Direct[0]=15,
                //  __
                // |＼
                [
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , △歩   , △香   , △桂    , △銀   , △金   , △角   , △飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, 0_____, //
                    // △王, △と   , △杏   , △圭    , △全   , △金   , △馬   , △龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, 0_____, //
                    // 空 , ▼歩   , ▼香   , ▼桂    , ▼銀   , ▼金   , ▼角   , ▼飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, 0_____, //
                    // ▼王, ▼と   , ▼杏   , ▼圭    , ▼全   , ▼金   , ▼馬   , ▼龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, 0_____, //
                    // ▼壁, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼空, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                ],
                // Direct[0]=-1,
                // ↑
                [
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , △歩   , △香   , △桂    , △銀   , △金   , △角   , △飛   ,
                    0_____, 0_____, 1_____, 0_____, 0_____, 0_____, 0_____, 1_____, //
                    // △王, △と   , △杏   , △圭    , △全   , △金   , △馬   , △龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, //
                    // 空 , ▼歩   , ▼香   , ▼桂    , ▼銀   , ▼金   , ▼角   , ▼飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, //
                    // ▼王, ▼と   , ▼杏   , ▼圭    , ▼全   , ▼金   , ▼馬   , ▼龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, //
                    // ▼壁, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼空, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                ],
                // Direct[0]=-17
                // __
                // ／|
                [
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , △歩   , △香   , △桂    , △銀   , △金   , △角   , △飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, 0_____, //
                    // △王, △と   , △杏   , △圭    , △全   , △金   , △馬   , △龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, 0_____, //
                    // 空 , ▼歩   , ▼香   , ▼桂    , ▼銀   , ▼金   , ▼角   , ▼飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, 0_____, //
                    // ▼王, ▼と   , ▼杏   , ▼圭    , ▼全   , ▼金   , ▼馬   , ▼龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, 0_____, //
                    // ▼壁, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼空, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                ],
                // Direct[0]=14,先手の桂馬飛び
                [
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , △歩   , △香   , △桂    , △銀   , △金   , △角   , △飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // △王, △と   , △杏   , △圭    , △全   , △金   , △馬   , △龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , ▼歩   , ▼香   , ▼桂    , ▼銀   , ▼金   , ▼角   , ▼飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼王, ▼と   , ▼杏   , ▼圭    , ▼全   , ▼金   , ▼馬   , ▼龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼壁, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼空, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                ],
                // Direct[0]=-18,先手の桂馬飛び
                [
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , △歩   , △香   , △桂    , △銀   , △金   , △角   , △飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // △王, △と   , △杏   , △圭    , △全   , △金   , △馬   , △龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , ▼歩   , ▼香   , ▼桂    , ▼銀   , ▼金   , ▼角   , ▼飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼王, ▼と   , ▼杏   , ▼圭    , ▼全   , ▼金   , ▼馬   , ▼龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼壁, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼空, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                ],
                // Direct[0]=-14,後手の桂馬飛び
                [
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , △歩   , △香   , △桂    , △銀   , △金   , △角   , △飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // △王, △と   , △杏   , △圭    , △全   , △金   , △馬   , △龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , ▼歩   , ▼香   , ▼桂    , ▼銀   , ▼金   , ▼角   , ▼飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼王, ▼と   , ▼杏   , ▼圭    , ▼全   , ▼金   , ▼馬   , ▼龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼壁, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼空, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                ],
                // Direct[0]=18,後手の桂馬飛び
                [
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , △歩   , △香   , △桂    , △銀   , △金   , △角   , △飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // △王, △と   , △杏   , △圭    , △全   , △金   , △馬   , △龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , ▼歩   , ▼香   , ▼桂    , ▼銀   , ▼金   , ▼角   , ▼飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼王, ▼と   , ▼杏   , ▼圭    , ▼全   , ▼金   , ▼馬   , ▼龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼壁, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼空, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                ],
            ],
        }
    }
}

impl Kyokumen {
    pub fn search(&self, mut pos: usize, dir: isize) -> usize {
        while {
            pos = (pos as isize + dir) as usize;
            self.ban[pos] as isize == KomaInfo::Empty as isize
        } {}
        return pos;
    }
    // pub Kyokumen() {}
    // pub Kyokumen(int tesu,KomaInf ban[9][9],int Motigoma[]){}
    pub fn print() {
        /*FPrint(stdout);*/
    }
    /*
    pub fn  FPrint(FILE *fp){}
    */
    /// ピン（動かすと王を取られてしまうので動きが制限される駒）の状態を設定する
    pub fn make_pin_inf(&mut self, pin: &mut [isize; 0x99]) {
        // int i;
        // ピン情報を設定する
        for sq in 0x11..=0x99 {
            // 0はピンされていない、という意味
            pin[sq] = 0;
        }
        if self.king_s != 0 {
            //自玉が盤面にある時のみ有効
            for i in 0..8 {
                let p = self.search(self.king_s, DIRECT[i]);
                if self.ban[p] != KomaInf::Wall && !(self.ban[p] & KomaInf::Enemy) != 0 {
                    //味方の駒が有る
                    if (self.control_e[p] & 1 << (16 + i)) != 0 {
                        pin[p] = DIRECT[i];
                    }
                }
            }
        }
        if self.king_e != 0 {
            //敵玉が盤面にある時のみ有効

            for i in 0..8 {
                let p = self.search(self.king_e, -DIRECT[i]);
                if (self.ban[p] != KomaInf::Wall) && (self.ban[p] & KomaInf::Enemy) != 0 {
                    //敵の駒が有る
                    if (self.control_s[p] & 1 << (16 + i)) != 0 {
                        pin[p] = DIRECT[i];
                    }
                }
            }
        }
    }
    pub fn make_legal_moves(
        s_or_e: isize,
        tebuf: &mut Te,
        pin: &mut isize, /* =NULL */
    ) -> isize {
        0
    }
    pub fn anti_check(s_or_e: isize, tebuf: &mut Te, pin: &mut isize, control: Kiki) -> isize {
        0
    }
    pub fn Move(s_or_e: isize, te: &Te) {}

    fn init_control() {}

    fn utifudume(s_or_e: isize, to: u8, pin: &mut isize) -> isize {
        0
    }

    /// 玉の動く手の生成
    fn move_king(s_or_e: isize, te_num: &mut isize, te_top: &mut Te, kiki: Kiki) {}

    /// toに動く手の生成
    fn move_to(s_or_e: isize, te_num: &mut isize, te_top: &mut Te, to: u8, pin: &mut isize) {}

    /// toに駒を打つ手の生成
    fn put_to(s_or_e: isize, te_num: &mut usize, te_top: &Te, to: u8, pin: &mut isize) {}
    fn count_control_s(pos: isize) -> Kiki {
        0
    }
    fn count_control_e(pos: isize) -> Kiki {
        0
    }
    fn countMove(s_or_e: isize, pos: isize, pin: &mut isize) -> Kiki {
        0
    }
    fn AddMoves(
        s_or_e: isize,
        te_num: &mut usize,
        te_top: &Te,
        from: u8,
        pin: isize,
        r_pin: isize, /* =0 */
    ) {
    }
    fn AddStraight(
        s_or_e: isize,
        te_num: &mut usize,
        te_top: &Te,
        from: u8,
        dir: isize,
        pin: isize,
        r_pin: isize, /* =0 */
    ) {
    }
    fn AddMove(
        s_or_e: isize,
        te_num: &mut usize,
        te_top: &Te,
        from: u8,
        diff: isize,
        pin: isize,
        r_pin: isize, /* =0 */
    ) {
    }
}
