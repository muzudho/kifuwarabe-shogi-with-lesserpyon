//! 局面の実装。

use crate::Kiki;
use crate::Te;
use crate::DIRECT;
use crate::{KomaInf, KomaInfo, Kyokumen};
use num_traits::FromPrimitive;

impl Default for Kyokumen {
    fn default() -> Self {
        Kyokumen {
            banpadding: [KomaInf::Wall; 16],
            ban: [KomaInf::EMP; 16 * (9 + 2)],
            control_s: [0; 16 * 11],
            control_e: [0; 16 * 11],
            hand: [0; KomaInf::EHI as usize + 1 as usize],
            tesu: 0,
            king_s: 0,
            king_e: 0,
            can_move: [
                // Direct[0]=17,
                // |／
                //  ￣
                [
                    // 'Cascadia Code' のような 等幅フォント にしても桁揃えがずれるぜ☆（＾～＾）
                    // プロポーショナル・フォントなアルファベットを使う海外に 方眼紙 の文化は無いのだろう☆（＾～＾）
                    // ちょっとずつ だんだんずれてくる……、仕方ない 横幅を長く取って ずれ を目立たなくさせるか……☆（＾～＾）
                    //
                    // 桁揃えって何？　だって☆（＾～＾）！？
                    // おいお前、PC9801 の画面の　漢字とアルファベットが混合しても等幅なのを見てこいだぜ☆ｍ９（＾～＾）！
                    // 暴れたろ☆（＾～＾）！
                    //
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , △歩   , △香   , △桂    , △銀   , △金   , △角   , △飛   ,
                    0_____, 0_____, 0_____, 0_____, 1_____, 0_____, 0_____, 0_____, //
                    // △王, △と   , △杏   , △圭    , △全   , △金   , △馬   , △龍   ,
                    1_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, //
                    // 空 , ▼歩   , ▼香   , ▼桂    , ▼銀   , ▼金   , ▼角   , ▼飛   ,
                    0_____, 0_____, 0_____, 0_____, 1_____, 1_____, 0_____, 0_____, //
                    // ▼王, ▼と   , ▼杏   , ▼圭    , ▼全   , ▼金   , ▼馬   , ▼龍   ,
                    1_____, 1_____, 1_____, 1_____, 1_____, 1_____, 0_____, 1_____, //
                    // ▼壁, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼空, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                ],
                // Direct[0]=1,
                // ↓
                [
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , △歩   , △香   , △桂    , △銀   , △金   , △角   , △飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 1_____, 0_____, 0_____, //
                    // △王, △と   , △杏   , △圭    , △全   , △金   , △馬   , △龍   ,
                    1_____, 1_____, 1_____, 1_____, 1_____, 1_____, 1_____, 0_____, //
                    // 空 , ▼歩   , ▼香   , ▼桂    , ▼銀   , ▼金   , ▼角   , ▼飛   ,
                    0_____, 1_____, 0_____, 0_____, 1_____, 1_____, 0_____, 0_____, //
                    // ▼王, ▼と   , ▼杏   , ▼圭    , ▼全   , ▼金   , ▼馬   , ▼龍   ,
                    1_____, 1_____, 1_____, 1_____, 1_____, 1_____, 1_____, 0_____, //
                    // ▼壁, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼空, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                ],
                // Direct[0]=-15,
                // ＼|
                // ￣
                [
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , △歩   , △香   , △桂    , △銀   , △金   , △角   , △飛   ,
                    0_____, 0_____, 0_____, 0_____, 1_____, 0_____, 0_____, 0_____, //
                    // △王, △と   , △杏   , △圭    , △全   , △金   , △馬   , △龍   ,
                    1_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, //
                    // 空 , ▼歩   , ▼香   , ▼桂    , ▼銀   , ▼金   , ▼角   , ▼飛   ,
                    0_____, 0_____, 0_____, 0_____, 1_____, 1_____, 0_____, 0_____, //
                    // ▼王, ▼と   , ▼杏   , ▼圭    , ▼全   , ▼金   , ▼馬   , ▼龍   ,
                    1_____, 1_____, 1_____, 1_____, 1_____, 1_____, 0_____, 1_____, //
                    // ▼壁, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼空, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                ],
                // Direct[0]=16,
                // ←
                [
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , △歩   , △香   , △桂    , △銀   , △金   , △角   , △飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 1_____, 0_____, 0_____, //
                    // △王, △と   , △杏   , △圭    , △全   , △金   , △馬   , △龍   ,
                    1_____, 1_____, 1_____, 1_____, 1_____, 1_____, 1_____, 0_____, //
                    // 空 , ▼歩   , ▼香   , ▼桂    , ▼銀   , ▼金   , ▼角   , ▼飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 1_____, 0_____, 0_____, //
                    // ▼王, ▼と   , ▼杏   , ▼圭    , ▼全   , ▼金   , ▼馬   , ▼龍   ,
                    1_____, 1_____, 1_____, 1_____, 1_____, 1_____, 1_____, 0_____, //
                    // ▼壁, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼空, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                ],
                // Direct[0]=-16,
                // →
                [
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , △歩   , △香   , △桂    , △銀   , △金   , △角   , △飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 1_____, 0_____, 0_____, //
                    // △王, △と   , △杏   , △圭    , △全   , △金   , △馬   , △龍   ,
                    1_____, 1_____, 1_____, 1_____, 1_____, 1_____, 1_____, 0_____, //
                    // 空 , ▼歩   , ▼香   , ▼桂    , ▼銀   , ▼金   , ▼角   , ▼飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 1_____, 0_____, 0_____, //
                    // ▼王, ▼と   , ▼杏   , ▼圭    , ▼全   , ▼金   , ▼馬   , ▼龍   ,
                    1_____, 1_____, 1_____, 1_____, 1_____, 1_____, 1_____, 0_____, //
                    // ▼壁, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼空, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                ],
                // Direct[0]=15,
                //  __
                // |＼
                [
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , △歩   , △香   , △桂    , △銀   , △金   , △角   , △飛   ,
                    0_____, 0_____, 0_____, 0_____, 1_____, 1_____, 0_____, 0_____, //
                    // △王, △と   , △杏   , △圭    , △全   , △金   , △馬   , △龍   ,
                    1_____, 1_____, 1_____, 1_____, 1_____, 1_____, 0_____, 1_____, //
                    // 空 , ▼歩   , ▼香   , ▼桂    , ▼銀   , ▼金   , ▼角   , ▼飛   ,
                    0_____, 0_____, 0_____, 0_____, 1_____, 0_____, 0_____, 0_____, //
                    // ▼王, ▼と   , ▼杏   , ▼圭    , ▼全   , ▼金   , ▼馬   , ▼龍   ,
                    1_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, //
                    // ▼壁, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼空, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                ],
                // Direct[0]=-1,
                // ↑
                [
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , △歩   , △香   , △桂    , △銀   , △金   , △角   , △飛   ,
                    0_____, 1_____, 0_____, 0_____, 1_____, 1_____, 0_____, 0_____, //
                    // △王, △と   , △杏   , △圭    , △全   , △金   , △馬   , △龍   ,
                    1_____, 1_____, 1_____, 1_____, 1_____, 1_____, 1_____, 0_____, //
                    // 空 , ▼歩   , ▼香   , ▼桂    , ▼銀   , ▼金   , ▼角   , ▼飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 1_____, 0_____, 0_____, //
                    // ▼王, ▼と   , ▼杏   , ▼圭    , ▼全   , ▼金   , ▼馬   , ▼龍   ,
                    1_____, 1_____, 1_____, 1_____, 1_____, 1_____, 1_____, 0_____, //
                    // ▼壁, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼空, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                ],
                // Direct[0]=-17
                // __
                // ／|
                [
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , △歩   , △香   , △桂    , △銀   , △金   , △角   , △飛   ,
                    0_____, 0_____, 0_____, 0_____, 1_____, 1_____, 0_____, 0_____, //
                    // △王, △と   , △杏   , △圭    , △全   , △金   , △馬   , △龍   ,
                    1_____, 1_____, 1_____, 1_____, 1_____, 1_____, 0_____, 1_____, //
                    // 空 , ▼歩   , ▼香   , ▼桂    , ▼銀   , ▼金   , ▼角   , ▼飛   ,
                    0_____, 0_____, 0_____, 0_____, 1_____, 0_____, 0_____, 0_____, //
                    // ▼王, ▼と   , ▼杏   , ▼圭    , ▼全   , ▼金   , ▼馬   , ▼龍   ,
                    1_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, //
                    // ▼壁, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼空, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                ],
                // Direct[0]=14,先手の桂馬
                [
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , △歩   , △香   , △桂    , △銀   , △金   , △角   , △飛   ,
                    0_____, 0_____, 0_____, 1_____, 0_____, 0_____, 0_____, 0_____, //
                    // △王, △と   , △杏   , △圭    , △全   , △金   , △馬   , △龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , ▼歩   , ▼香   , ▼桂    , ▼銀   , ▼金   , ▼角   , ▼飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼王, ▼と   , ▼杏   , ▼圭    , ▼全   , ▼金   , ▼馬   , ▼龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼壁, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼空, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                ],
                // Direct[0]=-18,先手の桂馬
                [
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , △歩   , △香   , △桂    , △銀   , △金   , △角   , △飛   ,
                    0_____, 0_____, 0_____, 1_____, 0_____, 0_____, 0_____, 0_____, //
                    // △王, △と   , △杏   , △圭    , △全   , △金   , △馬   , △龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , ▼歩   , ▼香   , ▼桂    , ▼銀   , ▼金   , ▼角   , ▼飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼王, ▼と   , ▼杏   , ▼圭    , ▼全   , ▼金   , ▼馬   , ▼龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼壁, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼空, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                ],
                // Direct[0]=-14,後手の桂馬
                [
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , △歩   , △香   , △桂    , △銀   , △金   , △角   , △飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // △王, △と   , △杏   , △圭    , △全   , △金   , △馬   , △龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , ▼歩   , ▼香   , ▼桂    , ▼銀   , ▼金   , ▼角   , ▼飛   ,
                    0_____, 0_____, 0_____, 1_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼王, ▼と   , ▼杏   , ▼圭    , ▼全   , ▼金   , ▼馬   , ▼龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼壁, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼空, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                ],
                // Direct[0]=18,後手の桂馬
                [
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , △歩   , △香   , △桂    , △銀   , △金   , △角   , △飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // △王, △と   , △杏   , △圭    , △全   , △金   , △馬   , △龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , ▼歩   , ▼香   , ▼桂    , ▼銀   , ▼金   , ▼角   , ▼飛   ,
                    0_____, 0_____, 0_____, 1_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼王, ▼と   , ▼杏   , ▼圭    , ▼全   , ▼金   , ▼馬   , ▼龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼壁, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼空, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                ],
            ],
            // その方向に飛んで動くことが出来るか？
            // 飛車角香車と龍と馬しかそういう駒はない
            can_jump: [
                // Direct[0]=17,
                // ＼|
                // ￣
                [
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , △歩   , △香   , △桂    , △銀   , △金   , △角   , △飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, 0_____, //
                    // △王, △と   , △杏   , △圭    , △全   , △金   , △馬   , △龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, 0_____, //
                    // 空 , ▼歩   , ▼香   , ▼桂    , ▼銀   , ▼金   , ▼角   , ▼飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, 0_____, //
                    // ▼王, ▼と   , ▼杏   , ▼圭    , ▼全   , ▼金   , ▼馬   , ▼龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, 0_____, //
                    // ▼壁, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼空, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                ],
                // Direct[0]=1,
                // ↓
                [
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , △歩   , △香   , △桂    , △銀   , △金   , △角   , △飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, //
                    // △王, △と   , △杏   , △圭    , △全   , △金   , △馬   , △龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, //
                    // 空 , ▼歩   , ▼香   , ▼桂    , ▼銀   , ▼金   , ▼角   , ▼飛   ,
                    0_____, 0_____, 1_____, 0_____, 0_____, 0_____, 0_____, 1_____, //
                    // ▼王, ▼と   , ▼杏   , ▼圭    , ▼全   , ▼金   , ▼馬   , ▼龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, //
                    // ▼壁, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼空, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                ],
                // Direct[0]=-15,
                // ＼|
                // ￣
                [
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , △歩   , △香   , △桂    , △銀   , △金   , △角   , △飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, 0_____, //
                    // △王, △と   , △杏   , △圭    , △全   , △金   , △馬   , △龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, 0_____, //
                    // 空 , ▼歩   , ▼香   , ▼桂    , ▼銀   , ▼金   , ▼角   , ▼飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, 0_____, //
                    // ▼王, ▼と   , ▼杏   , ▼圭    , ▼全   , ▼金   , ▼馬   , ▼龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, 0_____, //
                    // ▼壁, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼空, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                ],
                // Direct[0]=16,
                // ←
                [
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , △歩   , △香   , △桂    , △銀   , △金   , △角   , △飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, //
                    // △王, △と   , △杏   , △圭    , △全   , △金   , △馬   , △龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, //
                    // 空 , ▼歩   , ▼香   , ▼桂    , ▼銀   , ▼金   , ▼角   , ▼飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, //
                    // ▼王, ▼と   , ▼杏   , ▼圭    , ▼全   , ▼金   , ▼馬   , ▼龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, //
                    // ▼壁, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼空, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                ],
                // Direct[0]=-16,
                // →
                [
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , △歩   , △香   , △桂    , △銀   , △金   , △角   , △飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, //
                    // △王, △と   , △杏   , △圭    , △全   , △金   , △馬   , △龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, //
                    // 空 , ▼歩   , ▼香   , ▼桂    , ▼銀   , ▼金   , ▼角   , ▼飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, //
                    // ▼王, ▼と   , ▼杏   , ▼圭    , ▼全   , ▼金   , ▼馬   , ▼龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, //
                    // ▼壁, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼空, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                ],
                // Direct[0]=15,
                //  __
                // |＼
                [
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , △歩   , △香   , △桂    , △銀   , △金   , △角   , △飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, 0_____, //
                    // △王, △と   , △杏   , △圭    , △全   , △金   , △馬   , △龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, 0_____, //
                    // 空 , ▼歩   , ▼香   , ▼桂    , ▼銀   , ▼金   , ▼角   , ▼飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, 0_____, //
                    // ▼王, ▼と   , ▼杏   , ▼圭    , ▼全   , ▼金   , ▼馬   , ▼龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, 0_____, //
                    // ▼壁, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼空, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                ],
                // Direct[0]=-1,
                // ↑
                [
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , △歩   , △香   , △桂    , △銀   , △金   , △角   , △飛   ,
                    0_____, 0_____, 1_____, 0_____, 0_____, 0_____, 0_____, 1_____, //
                    // △王, △と   , △杏   , △圭    , △全   , △金   , △馬   , △龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, //
                    // 空 , ▼歩   , ▼香   , ▼桂    , ▼銀   , ▼金   , ▼角   , ▼飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, //
                    // ▼王, ▼と   , ▼杏   , ▼圭    , ▼全   , ▼金   , ▼馬   , ▼龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, //
                    // ▼壁, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼空, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                ],
                // Direct[0]=-17
                // __
                // ／|
                [
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , △歩   , △香   , △桂    , △銀   , △金   , △角   , △飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, 0_____, //
                    // △王, △と   , △杏   , △圭    , △全   , △金   , △馬   , △龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, 0_____, //
                    // 空 , ▼歩   , ▼香   , ▼桂    , ▼銀   , ▼金   , ▼角   , ▼飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, 0_____, //
                    // ▼王, ▼と   , ▼杏   , ▼圭    , ▼全   , ▼金   , ▼馬   , ▼龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 1_____, 0_____, //
                    // ▼壁, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼空, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                ],
                // Direct[0]=14,先手の桂馬飛び
                [
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , △歩   , △香   , △桂    , △銀   , △金   , △角   , △飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // △王, △と   , △杏   , △圭    , △全   , △金   , △馬   , △龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , ▼歩   , ▼香   , ▼桂    , ▼銀   , ▼金   , ▼角   , ▼飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼王, ▼と   , ▼杏   , ▼圭    , ▼全   , ▼金   , ▼馬   , ▼龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼壁, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼空, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                ],
                // Direct[0]=-18,先手の桂馬飛び
                [
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , △歩   , △香   , △桂    , △銀   , △金   , △角   , △飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // △王, △と   , △杏   , △圭    , △全   , △金   , △馬   , △龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , ▼歩   , ▼香   , ▼桂    , ▼銀   , ▼金   , ▼角   , ▼飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼王, ▼と   , ▼杏   , ▼圭    , ▼全   , ▼金   , ▼馬   , ▼龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼壁, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼空, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                ],
                // Direct[0]=-14,後手の桂馬飛び
                [
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , △歩   , △香   , △桂    , △銀   , △金   , △角   , △飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // △王, △と   , △杏   , △圭    , △全   , △金   , △馬   , △龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , ▼歩   , ▼香   , ▼桂    , ▼銀   , ▼金   , ▼角   , ▼飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼王, ▼と   , ▼杏   , ▼圭    , ▼全   , ▼金   , ▼馬   , ▼龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼壁, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼空, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                ],
                // Direct[0]=18,後手の桂馬飛び
                [
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , 空    , 空    , 空     , 空    , 空    , 空    , 空    ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , △歩   , △香   , △桂    , △銀   , △金   , △角   , △飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // △王, △と   , △杏   , △圭    , △全   , △金   , △馬   , △龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // 空 , ▼歩   , ▼香   , ▼桂    , ▼銀   , ▼金   , ▼角   , ▼飛   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼王, ▼と   , ▼杏   , ▼圭    , ▼全   , ▼金   , ▼馬   , ▼龍   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼壁, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                    // ▼空, ▼空   , ▼空   , ▼空    , ▼空   , ▼空   , ▼空   , ▼空   ,
                    0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, 0_____, //
                ],
            ],
        }
    }
}

impl Kyokumen {
    pub fn search(&self, mut pos: usize, dir: isize) -> usize {
        while {
            pos = (pos as isize + dir) as usize;
            self.ban[pos] as isize == KomaInfo::Empty as isize
        } {}
        return pos;
    }
    // pub Kyokumen() {}
    // pub Kyokumen(int tesu,KomaInf ban[9][9],int Motigoma[]){}
    pub fn print() {
        /*FPrint(stdout);*/
    }
    /*
    pub fn  FPrint(FILE *fp){}
    */
    /// ピン（動かすと王を取られてしまうので動きが制限される駒）の状態を設定する
    pub fn make_pin_inf(&self, pin: &mut [isize; 16 * 11]) {
        // int i;
        // ピン情報を設定する
        for sq in 0x11..=0x99 {
            // 0はピンされていない、という意味
            pin[sq] = 0;
        }
        if self.king_s != 0 {
            //自玉が盤面にある時のみ有効
            for i in 0..8 {
                let p = self.search(self.king_s, DIRECT[i]);
                if self.ban[p] != KomaInf::Wall && !(self.ban[p] & KomaInf::Enemy) != 0 {
                    //味方の駒が有る
                    if (self.control_e[p] & 1 << (16 + i)) != 0 {
                        pin[p] = DIRECT[i];
                    }
                }
            }
        }
        if self.king_e != 0 {
            //敵玉が盤面にある時のみ有効

            for i in 0..8 {
                let p = self.search(self.king_e, -DIRECT[i]);
                if (self.ban[p] != KomaInf::Wall) && (self.ban[p] & KomaInf::Enemy) != 0 {
                    //敵の駒が有る
                    if (self.control_s[p] & 1 << (16 + i)) != 0 {
                        pin[p] = DIRECT[i];
                    }
                }
            }
        }
    }
    /// 駒の動きとして正しい動きを全て生成する。
    pub fn make_legal_moves(
        &self,
        s_or_e: KomaInf,
        te_buf: &mut Te,
        pin: Option<&mut [isize; 16 * 11]>, /* =NULL */
    ) -> isize {
        let mut pbuf: [isize; 16 * 11] = [0; 16 * 11];
        let te_num = 0;
        if let None = pin {
            self.make_pin_inf(&mut pbuf);
            pin = Some(&mut pbuf);
        }
        if s_or_e == KomaInf::Self_ && self.control_e[self.king_s] != 0 {
            return self.anti_check(s_or_e, te_buf, pin, self.control_e[self.king_s]);
        }
        if s_or_e == KomaInf::Enemy && self.control_s[self.king_e] != 0 {
            return self.anti_check(s_or_e, te_buf, pin, self.control_s[self.king_e]);
        }

        let suji: isize;
        let dan: isize;
        let start_dan: isize;
        let end_dan: isize;
        // 盤上の駒を動かす
        for suji in (0x10..=0x90).step_by(0x10) {
            for dan in 1..=9 {
                if (self.ban[suji + dan] & s_or_e) != 0 {
                    self.add_moves(s_or_e, te_num, te_buf, suji + dan, pin[suji + dan]);
                }
            }
        }
        // 歩を打つ
        if self.hand[(s_or_e | KomaInf::FU) as usize] > 0 {
            for suji in (0x10..=0x90).step_by(0x10) {
                // 二歩チェック
                let nifu = false;
                for dan in 1..=9 {
                    if let Some(koma_inf) = KomaInf::from_isize(s_or_e | KomaInf::FU) {
                        if self.ban[suji + dan] == koma_inf {
                            nifu = true;
                            break;
                        }
                    }
                }
                if nifu {
                    continue;
                };
                //(先手なら２段目より下に、後手なら８段目より上に打つ）
                if s_or_e == KomaInf::Self_ {
                    start_dan = 2;
                    end_dan = 9;
                } else {
                    start_dan = 1;
                    end_dan = 8;
                }
                for dan in start_dan..=end_dan {
                    // 打ち歩詰めもチェック
                    if self.ban[(dan + suji as isize) as usize] == KomaInf::EMP
                        && !self.utifudume(s_or_e, (dan as usize + suji) as u8, pin)
                    {
                        te_buf[te_num as usize] = Te::from_4(
                            0,
                            (suji + dan as usize) as u8,
                            KomaInf::from_isize(s_or_e | KomaInf::FU).unwrap(),
                            KomaInf::EMP,
                        );
                        te_num += 1;
                    }
                }
            }
        }
        // 香を打つ
        if self.hand[s_or_e | KomaInf::KY] > 0 {
            for suji in (0x10..=0x90).step_by(0x10) {
                //(先手なら２段目より下に、後手なら８段目より上に打つ）
                if s_or_e == KomaInf::Self_ {
                    start_dan = 2;
                    end_dan = 9;
                } else {
                    start_dan = 1;
                    end_dan = 8;
                }
                for dan in start_dan..=end_dan {
                    if self.ban[(dan + suji) as usize] == KomaInf::EMP {
                        te_buf[te_num as usize] = Te::from_4(
                            0,
                            (suji + dan) as u8,
                            KomaInf::from_isize(s_or_e | KomaInf::KY).unwrap(),
                            KomaInf::EMP,
                        );
                        te_num += 1;
                    }
                }
            }
        }
        //桂を打つ
        if self.hand[s_or_e | KomaInf::KE] > 0 {
            //(先手なら３段目より下に、後手なら７段目より上に打つ）
            for suji in (0x10..=0x90).step_by(0x10) {
                if s_or_e == KomaInf::Self_ {
                    start_dan = 3;
                    end_dan = 9;
                } else {
                    start_dan = 1;
                    end_dan = 7;
                }
                for dan in start_dan..=end_dan {
                    if self.ban[(dan + suji) as usize] == KomaInf::EMP {
                        te_buf[te_num as usize] = Te::from_4(
                            0,
                            (suji + dan) as u8,
                            KomaInf::from_isize(s_or_e | KomaInf::KE).unwrap(),
                            KomaInf::EMP,
                        );
                        te_num += 1;
                    }
                }
            }
        }
        // 銀～飛車は、どこにでも打てる
        for koma in KomaInf::GI as isize..=KomaInf::HI as isize {
            if let Some(koma_inf) = KomaInf::from_isize(koma) {
                if self.hand[(s_or_e | koma_inf) as usize] > 0 {
                    for suji in (0x10..=0x90).step_by(0x10) {
                        for dan in 1..=9 {
                            if self.ban[dan + suji] == KomaInf::EMP {
                                te_buf[te_num] = Te::from_4(
                                    0,
                                    (suji + dan) as u8,
                                    KomaInf::from_isize(s_or_e as isize | koma).unwrap(),
                                    KomaInf::EMP,
                                );
                                te_num += 1;
                            }
                        }
                    }
                }
            }
        }

        return te_num;
    }

    /// TODO
    pub fn anti_check(
        &self,
        s_or_e: KomaInf,
        tebuf: &mut Te,
        pin: Option<&mut [isize; 16 * 11]>,
        control: Kiki,
    ) -> isize {
        0
    }

    /// TODO
    pub fn Move(s_or_e: KomaInf, te: &Te) {}

    /// TODO
    fn init_control() {}

    /// TODO
    fn utifudume(&self, s_or_e: KomaInf, to: u8, pin: &mut isize) -> bool {
        false
    }

    /// TODO 玉の動く手の生成
    fn move_king(s_or_e: KomaInf, te_num: &mut isize, te_top: &mut Te, kiki: Kiki) {}

    /// TODO toに動く手の生成
    fn move_to(s_or_e: KomaInf, te_num: &mut isize, te_top: &mut Te, to: u8, pin: &mut isize) {}

    /// TODO toに駒を打つ手の生成
    fn put_to(s_or_e: KomaInf, te_num: &mut usize, te_top: &Te, to: u8, pin: &mut isize) {}

    /// TODO
    fn count_control_s(pos: isize) -> Kiki {
        0
    }

    /// TODO
    fn count_control_e(pos: isize) -> Kiki {
        0
    }

    /// TODO
    fn countMove(s_or_e: KomaInf, pos: isize, pin: &mut isize) -> Kiki {
        0
    }

    /// TODO
    fn add_moves(
        s_or_e: KomaInf,
        te_num: &mut usize,
        te_top: &Te,
        from: u8,
        pin: isize,
        r_pin: isize, /* =0 */
    ) {
    }

    /// TODO
    fn AddStraight(
        s_or_e: KomaInf,
        te_num: &mut usize,
        te_top: &Te,
        from: u8,
        dir: isize,
        pin: isize,
        r_pin: isize, /* =0 */
    ) {
    }

    /// TODO
    fn AddMove(
        s_or_e: KomaInf,
        te_num: &mut usize,
        te_top: &Te,
        from: u8,
        diff: isize,
        pin: isize,
        r_pin: isize, /* =0 */
    ) {
    }
}
